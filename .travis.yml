services:
- docker

env:
  global:
  - secure: "b7f77aPg0gOJ5nHcKBiR6Pu7+V2Mq4TZ+f6bcmCmyNh7jpNwZd0PN2XRKaGuautFfGMd7RmkKsdfyWDeqm3J+YR6LzEqwaAULfzvrlQNId8AVFfrke/uoNwNOUczX5L9h5zpLK63AzUXIO8KwVO4d8xBV8wtcW+AqjC5q79Wq2ZfETELN7l+0ZtaAwjgdDtMufhcRvZ8TIw1VTM6D6fclumf7qaoDZF3BSnS8Ar+m9yfuMDoDckt+dT2bFEBN+SK3/IOJdHxlzbMsEQSDrz6c1HA+rOkiEYDnO7wfJguyTJp3LURBDlt2ScMsL2LGXiV0Y0rK26lvizGjlvgSfQmK7dG1Xtv8fPDS++K+E2Mpa8jiCb4ZxAxxJs7j4KK+hBpsjTBglE6k7Zb0/IeLYaf05SKwVz9+e5zrlaCBQ5vul9XQikLy1fHw4jXIMqjzaHlWt5SqFX2p+yK31xs76aCNNy/RT/QKjEh6iEwsN3QEzAgHqecjehArbSGod5Q1t0rNspsssUj8li3iFRu3cmoBSlSpsqtndu7i0FP5lIRHbE4p/Xq1Gw4XNM2FCD+1bLiyJQfkSWNeghIA189cECvLDyjyiaNNg3bZHMKa1ocjqRzOF1Hj9JMksAxSyxD6zYwXvEvl8ku6gog1MvEfTgiP+kQAAnnOOUjvq5IjlU2s64="
  - secure: "Shfykzt3i9J5ShuzzPS9A9YapSYE9ggyUckybq11KS7mfv4RegaWHQTIkohUbdP9covts9+m+vaBMUqHKpTqCGtZZv5TEoDCypohXujc9ml1Kk3qc3N/6FYrpt8qirplWRMuicCpvmIRzrQ22kpNupkE+7SkjB5T9JzKeyFZHDX5+fTFF2O41VhUvdZDBSPl+UtlCwruSzlBxHc7ZQZswxQgEy90SX5mJspH+QANRPE+hMpMVPUgrExnC4N7gVFCqnIOcSgzk4u/RbMm1Fye6a6+h1mU6Rmm9e/86oZ0LU1vTdj6TFYOapT0WrPw8W7X1rTC+29YnHg3ikvoHqQo0+uWhRP5Wb6BHtq12xfYQVlGgy+kRV2pfB7AEPlOp9jCQeAWx0iu0Of1QCuWyRQKM89JUErc4Ee2aOWJPr45EZaUPWzObfRET8QJIRxiX21520KiIc2MOd6dOzDba5SHJk3ZcvTHwC00ZfbG2/dmEkw8fgQwQHfG+YszfkO8LuCaitRFU19+q/qf4IfMJNMZUVtok4uuW63jkurSXDR4ub8mbyHH42Rj8+x1/NuuCq54cTw0lF8ya3ZNIp2StMqjnK1m5XUXoqVbB1PCry9MlggNKnqEW5wFTNuS6pyrW8GanfeSITI+36StpGGwlHNhSFg0BzR78Hc059kxy8YYKqs="
  - secure: "d4NtPyHgynqStDDrE/vBG3BWAM4fJn4x5f7fnfwLmanooYrtC2zd7EAIfTBTnF0e3rgJDJt+3MeLjIlOlBxJddDboUtcQkkEwFayhwnHEvxCnRyPS9oLMmRsmqiSULCA9U5sFtilVRHGDejCWKpoWUagVvzLjga1MlL/dweUR24046VjD0m6javl0i0a0GED9RxARGJo0vlj31jOXJu9RDi2w+0ppkCOxcYeH9+Dzt02yhrpX0s9DTskZzDw4JdUym7W6fA0e06yK9MEOshMgfQOokE1qt3X6fJFKSvds1dnXOrL6+2JyvNyiuc/JRDujP6+Y+whJhhg2hKF91AU/udenT8VdOPQEY94yK3zVtebjjwv08iIZdJ7pGOp76qb3EGZV7rN2kjzum7Ay7sFhmtoTcTPrO/1oIjf4eCxIOPWMr21njPmsUrufBxAjEMuB8M/HR6y9ZPhm+wpHbUU9wD0YhNLS1j9i0sCEaUF6fJMDcPDIHBmvsfGGIN7VTRaMwvgfeFftDakH2Z8Ore8ZZ6j/lxytcbXu4n/pl/JJUXbF8+bw6GZrAguLPrh0qbqQTPJXSzHKBh53+1nTh5s63PDXZ4XXgT9v/ghMyW4AyxNosRvmqjrPAihQiAjSPqKebP1gBJgPJH6WyNLJpnKBirewgulus1t8Q0EVfWSUS8="
  - secure: "EctP//85ifHzyDAaNDF4Zic/0rZxwx+RJn5IcUbsW3hLv6KfK94S2ybwlg5UnXgB5w5fKNQrNWMMNx0XPQ+bcsEQX43yBpJwpKeXXqwN8jYON3nsroVbkE9Bq//tU/Tbee5ihQRFIu0EOOtfinpkAtKvw3VUYqmyUPN9HOxVsj9ee/5pbgnCAPuu3YcThhMC5fvbD0xeaPQ/oqNW17WkDmRONtLQWoF5o/h1s+atkCR+rbFtggF8N4MJkyCbiryL7U0p3UQW5gRls0SbWfsPhUSAH4Sy7phyYApH4PlU2A+SoWUJ2MFgr3tQ0T3Jlb7Ana3JRHWF9pEnBnBI0BllL/SRk7P1B+qkzu7PWxuzxlAhxMeYjZnikR1N85jyTmQQi+XaUs2BPGPjoZ8IpJoGcsDsXiygoMT9xErMzGZDo4/bdaNAWI+fCA9gnnix39I/c67VP/9TCYZPlzxgr/sdbC6kURZ0oP1spjb37fd0+EfO0K5PZZW8RzK3wZ9TUg4gPGM1pFmIAypetoMj3AzwaDW73CQ9NMAuzvw491D99dFWhJ/FbG4hEhxdFFizSYbzuewH/sD0SHS4mDBs6wV8RB+OXKvnDkeGBb8zz5ij1dYrMPe1SXIAdTEEMzf6CjHhaOKrqWFs0t4ppQdntgtXxWWlDfNgAE5IPxlg+QKNW1E="
  - secure: "Hx62qRgxYb+zz3tdjuxT/MISZt388OAFV9aZdOGHiEMvlwmHQ7aIn98f2Bc6DZcTNYBItvt7rgk4ueskXfChxoIM+KCV/o915/qw5BldurqHUI1KLJuoKVwybly1G1F/De4zlmueNyitOISvmFg4X24QUk+LirI7xv+96NCOvwC6b69tYY2xqI3Dugdtne0oJlipaX+2wwcdt4p/d8luPUukjHmyvKzfvRGzmTFF0XihRDPjDFggW23j5y/XVU7JWogNK2wKQv8VUVRfJEJqdPUCfz3P/05fFzogKAF9Nc21FsDG2OIarbFtfgKzU2zLsY7HU9lrmwFN5/5tr2oQ+rwdMAJSuBTBAPLRkqMI3xTlwe8KNrnam/MAQTR9n2adGotMJaEfECzDQNhkcZaXKtroFGXzRG4ciQDdcmgSbmzplWgomU4z3ZaeotEiRvjXkZyPgDZwed5rNQQRSwCl86JCsoRz04THXKUmBwe+OfJZoJ9b3UjclMjGrFy/eZpOxb99jPHZ6pVs8PvWBQDvpXBnGTrp7taTle7Z5gxtBKr/6IZG8hw0ITK94rdDkAz3I/FDkU8Yg+aEiC95vn7HIYhgR7C90pD+2e33bKR+KA8rVl3uSF2qpj22DmemZZCQUDrcIxQJ2/yCC5k8DTUm5nLh0SvG9oCqdpeULVeHeHY="
  - secure: "r5CW4neJh0U2gVe7UW+LvAhwE028yLR0Utl5PO/KDpKSiagtEWiSKOuxDqwTBlTOGZtWArfPH4bnfow59t2fsCighikwxcR5kRhm4cQiS7LpE55i5kNbc2wWd0yoAFUfbGuBmwxSGXAgUUPg2bR3PwopruhrINfzbRu9nfrPWexc3lsWb5mkqaCCYdCyQAI4R2SmJE1TNWkh2js7QL0mGBdMbdPcyxriTBcxJNy0aHLdpAdM65Z3ZECv6UT2bkRd5uJnxmLjItnSJOOUNhCAKFs3USTHHyN0CDJRf5An5DAJB9LF/lHC8xiKf/b8R/hMBhIMkkhGgxrGUrAK3Ekf8RHawZTf+smheg6VfIgdjXXGgJQTQzwnNcOU21vbICoEcpLuT3woK+x1/8PFsI4jtpAZYOwUB0d8ERw7FjXCMNXMu79kHm2c8PWhmO1Y15MvkHm/nFWzwmZNOg9KcG2hIzNgUqV+ebzoz+38FGm7Z4YB4CHDBgBmagSYZSnlCbHS0DWr4jhQgFl/VHkZfuFpAAnU+cIA1zgpykLUhg1WE45Y6CFWrFkiMrTqGU5n2OVv/Fa87OReB7JYDzRVg4h5f3l3tfFuZRh+8qm18/yDukr2MuREix0dk2db/I6HqqVVMsyn9lPbNObFATg79kHaIIeOSUQZbI7TiAorGnrlViY="
  - secure: "d7N8rSODEzUgbgnukasKklJy+2UUMJus+Cg292t8c1ECIxsp01RNca1Tgi7UxtsZxK4a0D41po1r7B2zz7mGfxD92hI2pG0jubaUD4kMWKIoufFaUt64yXNMEzpmo4JcUOBaps2Nrf8EgeREXs7lgHOuhxWVczzpwNULLPac+xqHxxIzATSs5vzUQTOfHJGCCKvsZ9zHa5VU/7houPIB0ftrEE3zQWwDSF8txlUKfyWrbCb81JK5L7Hi1dbu7ii3ebc9RPxsW/rb1N0VCv/1ZUiMyIcEuHv153E1QfZORKSe3PPfcWfVQYTEG7hNWPorQtDGIihMHfDX/DoV06WLMQj4ka73BfegFoHyt3ekjg3s+c0WFRv10O3BuF28w5d8rNy1POgjkPPeALYfxZJxvGUepsCL3v+aKORma4f+3nWXKIbMr14nrJSJTDIHTHP29KM3JQBZ5RozBCIb/WtVjoAteKqh+tkWogT1PyAKuSWfaUwc4kcF28IeyZ5B90I4hBwavVsdYKtmrl2BdW7vyqqC44fBzXRvGv+jtGKaLjdBITgkQ/4GOT1eHZ92tbMIT75IF750iyQni51KmbPefgOUSr79B1IvxGGwv8/BrSUsCwdvCfeFLJD0KZmtAaHkOJgtzU81Alm1TiqfOLh9A+EXEIqEjCY8ZE7IwqSXzo8="
  - secure: "bNrgVOlKf3ham8uf/Ml4toCVT7SVF5+x/NVtDgG8Qza+91VlkXho7la+NUpzCMVzX6X0gQ0Yw6siLTv8xBaei6lcb7yB1e2/RSQHoeNM5TxXG3Zl+Bd4GCbFqJexnfnnXGap/f6U4XlVSAw7jq+Vrs9nvzQwujHTXIJIk+V2NYpQxMlQmYGbnZRk/6dkZ8r5yefeb7iO4Y+HPf7PkTt2qFt1v5V6mWPjSfwxMxkC+z/cs0IoXWO1BnUxr3lhoSXJ+GlJk4qSGOAgKofa9SI/SUp0/Hd6jRH8CUqVEGmVniizAIXkI+SX3Cr/DSFImLocWsMgj1i5y1ZNdSXzLMd1v8UkPh5cjJf7GChsZnIMabKXPhCQinOB054X+yBl6J3IsPXQuNu5rCKrSS2hsjhsnR5hcgiBYUC1GNSpD64FL7MFTnH4zACEmYwxDFW3Aa5xVJc9nYLz96qkagG06me6/Moy1D4ceNVuu6SXrmodvbjO4n6qrACCavxMZYWjsDnjlv0xHigaulR2qKwUEOaSH5Josq+qntRCSLhlVUVhT8VAV5CjusP9ar0byuocgwJL/CxW/e6Xlu9VQFzCN/OpgEUO3o3h5+xp5HnnkwdrHRcD4dl4twC6umZDDjd+6er72PN9poLfSWIvE2Z+kxcw9DXeTXHOClO9rLXOFRwA/BI="
  - secure: "PufKsyo8HZP75GGcWGgrGBoaX5OjmIhI7p+kaXYP2fLIZmhy6nSa2MRdGAGYIvNTM7Idxf5tQq+njipJpdIBqWnASXDcbjbW6mVXSXUvKn41IGhqpQfCGv76VunSU7hJA1H2+v5bU7HhdNnuKb49FsidSMhqEItbo6W/nN7Siax1S+YmLNdsrJZouzrk0QKj3zoQrRLbShbzdMsfD7T5+yAfrhi49gSQG3U414jzmG929IjJ1RcnCCu640smS3fXOgXsU/VBsN1UlHEcWMzUe7lt0wFNDAzW+cPpXaI1P9cP8DkdnLGUoESaD7ksVkFurjVTCTh1jPz9Hb4ibvsk9zKtwFLk5zQGKbdEeCdDY4i11en9M/90Srl6Qg+hwFNayx57A18fek6aKWYEjejb/C5N+wwMV0Nj8T4uL7laYg0peIpBEPHU2/HKpV1TZK6941PKujaDUEdUDqob/l4f9BFIqA0hU4ai+ImQmsBYXNWEnQUK1byL3jG4JJHSIExZHt0MK3UKWXFSy3+QfFuSRn9+KDGhJY3YsMbupgNei5dQjdB2iDui4M6WEl080J2h+HvFWQi0D8iCoVtuFQ0fbhHLdK1lXpcKtlecZ6caEqml0KsS9i8iEo8KH0DWIeUgzGSXm/j0GoAT7eFs1NmSXs32xHvcN1DXnupW9IuQ9eI="
  - secure: "cz8Z6uAtn0ZlHHQEg70EMuN+7CEqTLyfHZfL5gHrZuf68nEFUbUW5LkGaAv6hi/RZvPVgBz48zYkA4maVVTulpu2VVenmiLarMIaLGoDu0L9TV3CvqXiwpHzmeMuO8WCVQGJIb/2ixW6pziTqHrr9nXIkXyqJ2qcZaknH0T88daSyhUoU5uRo+fXC0cTOD8SPuJg5FpdBUUHN3byU8wlW/JzP46popAKJmc3FT1mDjcCxwIaFyrRePVqibmyJRwghotg6/+Ll3LxUIVhs32HeE9aak+ASpkdj74zSI1BXPBsvnMcNkHTPEAqb577TpVl27k8o8xcVN2puOnJabLOIvAEnbGr7sulDNWB/fjupD89560JTHwr41ALlt7XmVM6XcmQIYgJhfvLhc1II5JnclaTxzH5e8U6cojULjwMqXZDV1dnhCzY68QVV0LqiM9NR1SqItesxTqfmjWWWrtrMSZOXhbtLeuaJlNKLieFhNVdaWeimd2bAaE37Wf0ypkgCsgmVdNUmZdXFaTuqBBhanxYT6eXgoXF0lvhHDWoFadrMDN2QPaw/MUgOEAhnAl+kBc5s70fJ67dtxtir2PDr5AMqfrVU6CC4cb1Zglrjh2eoJV51UJiW2CywWLI7e+Vz4m4gnp/xQFtBfQpXOZGmxU4Fi5paOq3Og9qZs6fwdg="
  - secure: "l/mvNwWkYbYLJnCKGCjl7iUEerY63Cn7hjjslz1ahfGWSKdkVqm7cW0/zLvJ5c2H0Lak99Hyv35smkZYmH7mmRs0phlMQjC9fxzjZ7Vd8TZzMFbmKoxfUd8pzDgmffc9aOOY2Akw/vxKR2rzcGt7JL/bW/9HF+8pxwsYj22RtHsLQ2TD1DykZXORwUWyBMdtuFmPeWNQvIfDRrrh/+dbKk+2GymTMVUDn6AMdCnNKUCRfT6EjNTXZZxjyozJKe7u4jSuY0jPtCLZuRBKDfrknG+aju2gr0iQKNA1+dirmjSC76DZ5QCLlF1QVFUktJVPceLi0/0cdf0xHTRi6VgOxkyLXvvfw92ujpha64cg/Twgx2Z2I7bNeEbrcytSTa01VtwaeatvDjdqVjY5TCXe6fg2r//gAbJlrBZ9Puzo0UTemIM2/3aqWFpB2ZBYaOHKenFeHknoBJjToiV2ycEoRzbbkGs5DmmdIpLlIUxOMp2RXyF/c7IcqZq6QDE9tsY+fkyt2cm5fqHBfvqi8NYqCho9PS5u7P/h0ohzmq3Urmp5FHXJfq5RGuIUnqSV/YCU6I1DG29dOIQ3GSC+zHYBw6AsVkg9kvkHydEWpRAUZBUbe/EeEW3Y/R6+V2NZU6+NQuH4+d6Xl5h2mE062R/MOR86w9vA7gdCtWCp7YQBeZM="
  - secure: "ZryKyWiHvMM6BfaMByVDGJ+P56XGWj24wqCxvbpvmyuWEa3g37wCbqB6F0xAzFDg2rNk8ws9cPBADPG9mnPHFOKNymZF/fhonjWHlXpEF6mf1WbARIbpBe4sdGsNn8uPGCBDhdh+PtDhz5vr1YN2n8rpDOPLUwAiit7BN8sDN52sAXfqwmJ9fuuCYoYR60p71Qf61ZP5m0uHvf5u6RSLIe5skPZREsjtA3Dr+jBtD/vkNZc6Uv5+sAS7EECb03xx8+IwlNcjZuDAmhEadgLDr74gnOTfW1TVfZUd6pS9rt5AZsFlbLcsc8PQy7T5N7jTn5cK1DXe19KKKYeL1SJHhhD70v36ZgDs5G7EdujRepviM6BFqUhj2zNSJFtV0GPcBnTwaZ85dkQzo4h61gLN1JxEuBGiOvysGE1z/F48AVapkwwkGe/WepoZm7BLZOV47QNy5GBPWN/AjM/AZEsbALXEsPEEpldRxhoG6jlAvsIFqNr+3rGxoYmMF8QlS5DP0X777CItG2bnozKvFiau7+w3+X7MLtIUUlXbcP+/NMjEDkAnJADlBw2o6bop8DhJcqML+9I8sT/mGQQ/P9xTFwuqVq9RTnDAWLQU1Ffj97YnFwFPQE+oq6HLZ45fhiYvK2NV+Rdyabm7/kRw9tHA5gpl8kqiRfIezuOdt1UHCDU="
  - secure: "EkfjmgngN6vA30m+udRNaV/Y9wckNVzY1YnElVlmsZgmlKc+MktIbSMFE/Onvpc9Xx718lg+bdg3SarrVZp3VlIh3BJ0wevuQC1cjznJkYHQ1vLiE8XHWy6D3sHJIODk5ViFDXEF1p5Jgf/HtUwzwP5wQd9MpwJiQ8iky+/iOo5Hx1V84etXvIJw6cWTtyH1blnSLUvTnlgZ69mBkxoXmvUSPlWrIFq0hM2W0qj8a2ibHvM1zs3mwmnIRlRvGgFyqLhXNnOzi33RuP25Dc8JkGpChph252RVFhm5H3nXbmHI3cw697dEdVFXrWHGB+3jwuV7X5SHJfpyu8LuDETJaZco2+m0xIvWiXffneI8CpSXqsTECdd1E2zUJMtZwIfA89/Xc/SGLvyT9ujI40FglQ63tSSZYwjHfnwQY8q1oMvTsOsEWOS8t58ypk4BqrYk522T7IAPccvodrOp2xW3BALPxexLray0fWV73YVZZpCVBllff68x3x8ZulNhjrUDB8ZHseFyiraG7z3ZBLMpnfSE8INqCagSUqcBvnWR6w+xvx2L1nDjx4FXtHuhv9M0w21HwGL0dHoMyWOMPezxTy/GY4PXko8izrgBIrdXNFo20ODaxRRmAfl4oCHUnsiVJ4RgbPGWZ8hLDzc9kBa7zgSTBvpKmDZdl/uQoWRBB/0="  
  - TF_VERSION="1.0.9"

script:
- docker build --tag todo-app:test --target test .
- docker run todo-app:test todo_app/Tests/test_items.py
- docker run --env-file .env.test todo-app:test todo_app/Tests/test_app.py
- docker run --env MONGO_URL todo-app:test todo_app/Selenium_Tests/test_Selenium.py

install:
- wget https://releases.hashicorp.com/terraform/"$TF_VERSION"/terraform_"$TF_VERSION"_linux_amd64.zip
- unzip terraform_"$TF_VERSION"_linux_amd64.zip
- sudo mv terraform /usr/local/bin/
- rm terraform_"$TF_VERSION"_linux_amd64.zip
- terraform init

before_deploy:
- echo $DOCKER_PASSWORD | docker login --username $DOCKER_USER --password-stdin
- docker build --tag $DOCKER_USER/todo-app:latest --target production .
- docker push $DOCKER_USER/todo-app:latest
- terraform apply -auto-approve
- export WEBHOOK_URL="$(terraform output -raw cd_webhook"
deploy:
  provider: script
  script: bash ./webhook.sh
  on:
    branch: module_12

