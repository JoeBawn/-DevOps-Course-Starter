services:
- docker

env:
  global:
  - secure: "b7f77aPg0gOJ5nHcKBiR6Pu7+V2Mq4TZ+f6bcmCmyNh7jpNwZd0PN2XRKaGuautFfGMd7RmkKsdfyWDeqm3J+YR6LzEqwaAULfzvrlQNId8AVFfrke/uoNwNOUczX5L9h5zpLK63AzUXIO8KwVO4d8xBV8wtcW+AqjC5q79Wq2ZfETELN7l+0ZtaAwjgdDtMufhcRvZ8TIw1VTM6D6fclumf7qaoDZF3BSnS8Ar+m9yfuMDoDckt+dT2bFEBN+SK3/IOJdHxlzbMsEQSDrz6c1HA+rOkiEYDnO7wfJguyTJp3LURBDlt2ScMsL2LGXiV0Y0rK26lvizGjlvgSfQmK7dG1Xtv8fPDS++K+E2Mpa8jiCb4ZxAxxJs7j4KK+hBpsjTBglE6k7Zb0/IeLYaf05SKwVz9+e5zrlaCBQ5vul9XQikLy1fHw4jXIMqjzaHlWt5SqFX2p+yK31xs76aCNNy/RT/QKjEh6iEwsN3QEzAgHqecjehArbSGod5Q1t0rNspsssUj8li3iFRu3cmoBSlSpsqtndu7i0FP5lIRHbE4p/Xq1Gw4XNM2FCD+1bLiyJQfkSWNeghIA189cECvLDyjyiaNNg3bZHMKa1ocjqRzOF1Hj9JMksAxSyxD6zYwXvEvl8ku6gog1MvEfTgiP+kQAAnnOOUjvq5IjlU2s64="
  - secure: "Shfykzt3i9J5ShuzzPS9A9YapSYE9ggyUckybq11KS7mfv4RegaWHQTIkohUbdP9covts9+m+vaBMUqHKpTqCGtZZv5TEoDCypohXujc9ml1Kk3qc3N/6FYrpt8qirplWRMuicCpvmIRzrQ22kpNupkE+7SkjB5T9JzKeyFZHDX5+fTFF2O41VhUvdZDBSPl+UtlCwruSzlBxHc7ZQZswxQgEy90SX5mJspH+QANRPE+hMpMVPUgrExnC4N7gVFCqnIOcSgzk4u/RbMm1Fye6a6+h1mU6Rmm9e/86oZ0LU1vTdj6TFYOapT0WrPw8W7X1rTC+29YnHg3ikvoHqQo0+uWhRP5Wb6BHtq12xfYQVlGgy+kRV2pfB7AEPlOp9jCQeAWx0iu0Of1QCuWyRQKM89JUErc4Ee2aOWJPr45EZaUPWzObfRET8QJIRxiX21520KiIc2MOd6dOzDba5SHJk3ZcvTHwC00ZfbG2/dmEkw8fgQwQHfG+YszfkO8LuCaitRFU19+q/qf4IfMJNMZUVtok4uuW63jkurSXDR4ub8mbyHH42Rj8+x1/NuuCq54cTw0lF8ya3ZNIp2StMqjnK1m5XUXoqVbB1PCry9MlggNKnqEW5wFTNuS6pyrW8GanfeSITI+36StpGGwlHNhSFg0BzR78Hc059kxy8YYKqs="
  - secure: "d4NtPyHgynqStDDrE/vBG3BWAM4fJn4x5f7fnfwLmanooYrtC2zd7EAIfTBTnF0e3rgJDJt+3MeLjIlOlBxJddDboUtcQkkEwFayhwnHEvxCnRyPS9oLMmRsmqiSULCA9U5sFtilVRHGDejCWKpoWUagVvzLjga1MlL/dweUR24046VjD0m6javl0i0a0GED9RxARGJo0vlj31jOXJu9RDi2w+0ppkCOxcYeH9+Dzt02yhrpX0s9DTskZzDw4JdUym7W6fA0e06yK9MEOshMgfQOokE1qt3X6fJFKSvds1dnXOrL6+2JyvNyiuc/JRDujP6+Y+whJhhg2hKF91AU/udenT8VdOPQEY94yK3zVtebjjwv08iIZdJ7pGOp76qb3EGZV7rN2kjzum7Ay7sFhmtoTcTPrO/1oIjf4eCxIOPWMr21njPmsUrufBxAjEMuB8M/HR6y9ZPhm+wpHbUU9wD0YhNLS1j9i0sCEaUF6fJMDcPDIHBmvsfGGIN7VTRaMwvgfeFftDakH2Z8Ore8ZZ6j/lxytcbXu4n/pl/JJUXbF8+bw6GZrAguLPrh0qbqQTPJXSzHKBh53+1nTh5s63PDXZ4XXgT9v/ghMyW4AyxNosRvmqjrPAihQiAjSPqKebP1gBJgPJH6WyNLJpnKBirewgulus1t8Q0EVfWSUS8="
  - secure: "EctP//85ifHzyDAaNDF4Zic/0rZxwx+RJn5IcUbsW3hLv6KfK94S2ybwlg5UnXgB5w5fKNQrNWMMNx0XPQ+bcsEQX43yBpJwpKeXXqwN8jYON3nsroVbkE9Bq//tU/Tbee5ihQRFIu0EOOtfinpkAtKvw3VUYqmyUPN9HOxVsj9ee/5pbgnCAPuu3YcThhMC5fvbD0xeaPQ/oqNW17WkDmRONtLQWoF5o/h1s+atkCR+rbFtggF8N4MJkyCbiryL7U0p3UQW5gRls0SbWfsPhUSAH4Sy7phyYApH4PlU2A+SoWUJ2MFgr3tQ0T3Jlb7Ana3JRHWF9pEnBnBI0BllL/SRk7P1B+qkzu7PWxuzxlAhxMeYjZnikR1N85jyTmQQi+XaUs2BPGPjoZ8IpJoGcsDsXiygoMT9xErMzGZDo4/bdaNAWI+fCA9gnnix39I/c67VP/9TCYZPlzxgr/sdbC6kURZ0oP1spjb37fd0+EfO0K5PZZW8RzK3wZ9TUg4gPGM1pFmIAypetoMj3AzwaDW73CQ9NMAuzvw491D99dFWhJ/FbG4hEhxdFFizSYbzuewH/sD0SHS4mDBs6wV8RB+OXKvnDkeGBb8zz5ij1dYrMPe1SXIAdTEEMzf6CjHhaOKrqWFs0t4ppQdntgtXxWWlDfNgAE5IPxlg+QKNW1E="
  - secure: "Hx62qRgxYb+zz3tdjuxT/MISZt388OAFV9aZdOGHiEMvlwmHQ7aIn98f2Bc6DZcTNYBItvt7rgk4ueskXfChxoIM+KCV/o915/qw5BldurqHUI1KLJuoKVwybly1G1F/De4zlmueNyitOISvmFg4X24QUk+LirI7xv+96NCOvwC6b69tYY2xqI3Dugdtne0oJlipaX+2wwcdt4p/d8luPUukjHmyvKzfvRGzmTFF0XihRDPjDFggW23j5y/XVU7JWogNK2wKQv8VUVRfJEJqdPUCfz3P/05fFzogKAF9Nc21FsDG2OIarbFtfgKzU2zLsY7HU9lrmwFN5/5tr2oQ+rwdMAJSuBTBAPLRkqMI3xTlwe8KNrnam/MAQTR9n2adGotMJaEfECzDQNhkcZaXKtroFGXzRG4ciQDdcmgSbmzplWgomU4z3ZaeotEiRvjXkZyPgDZwed5rNQQRSwCl86JCsoRz04THXKUmBwe+OfJZoJ9b3UjclMjGrFy/eZpOxb99jPHZ6pVs8PvWBQDvpXBnGTrp7taTle7Z5gxtBKr/6IZG8hw0ITK94rdDkAz3I/FDkU8Yg+aEiC95vn7HIYhgR7C90pD+2e33bKR+KA8rVl3uSF2qpj22DmemZZCQUDrcIxQJ2/yCC5k8DTUm5nLh0SvG9oCqdpeULVeHeHY="
  - secure: "r5CW4neJh0U2gVe7UW+LvAhwE028yLR0Utl5PO/KDpKSiagtEWiSKOuxDqwTBlTOGZtWArfPH4bnfow59t2fsCighikwxcR5kRhm4cQiS7LpE55i5kNbc2wWd0yoAFUfbGuBmwxSGXAgUUPg2bR3PwopruhrINfzbRu9nfrPWexc3lsWb5mkqaCCYdCyQAI4R2SmJE1TNWkh2js7QL0mGBdMbdPcyxriTBcxJNy0aHLdpAdM65Z3ZECv6UT2bkRd5uJnxmLjItnSJOOUNhCAKFs3USTHHyN0CDJRf5An5DAJB9LF/lHC8xiKf/b8R/hMBhIMkkhGgxrGUrAK3Ekf8RHawZTf+smheg6VfIgdjXXGgJQTQzwnNcOU21vbICoEcpLuT3woK+x1/8PFsI4jtpAZYOwUB0d8ERw7FjXCMNXMu79kHm2c8PWhmO1Y15MvkHm/nFWzwmZNOg9KcG2hIzNgUqV+ebzoz+38FGm7Z4YB4CHDBgBmagSYZSnlCbHS0DWr4jhQgFl/VHkZfuFpAAnU+cIA1zgpykLUhg1WE45Y6CFWrFkiMrTqGU5n2OVv/Fa87OReB7JYDzRVg4h5f3l3tfFuZRh+8qm18/yDukr2MuREix0dk2db/I6HqqVVMsyn9lPbNObFATg79kHaIIeOSUQZbI7TiAorGnrlViY="
  - secure: "d7N8rSODEzUgbgnukasKklJy+2UUMJus+Cg292t8c1ECIxsp01RNca1Tgi7UxtsZxK4a0D41po1r7B2zz7mGfxD92hI2pG0jubaUD4kMWKIoufFaUt64yXNMEzpmo4JcUOBaps2Nrf8EgeREXs7lgHOuhxWVczzpwNULLPac+xqHxxIzATSs5vzUQTOfHJGCCKvsZ9zHa5VU/7houPIB0ftrEE3zQWwDSF8txlUKfyWrbCb81JK5L7Hi1dbu7ii3ebc9RPxsW/rb1N0VCv/1ZUiMyIcEuHv153E1QfZORKSe3PPfcWfVQYTEG7hNWPorQtDGIihMHfDX/DoV06WLMQj4ka73BfegFoHyt3ekjg3s+c0WFRv10O3BuF28w5d8rNy1POgjkPPeALYfxZJxvGUepsCL3v+aKORma4f+3nWXKIbMr14nrJSJTDIHTHP29KM3JQBZ5RozBCIb/WtVjoAteKqh+tkWogT1PyAKuSWfaUwc4kcF28IeyZ5B90I4hBwavVsdYKtmrl2BdW7vyqqC44fBzXRvGv+jtGKaLjdBITgkQ/4GOT1eHZ92tbMIT75IF750iyQni51KmbPefgOUSr79B1IvxGGwv8/BrSUsCwdvCfeFLJD0KZmtAaHkOJgtzU81Alm1TiqfOLh9A+EXEIqEjCY8ZE7IwqSXzo8="
  - secure: "bNrgVOlKf3ham8uf/Ml4toCVT7SVF5+x/NVtDgG8Qza+91VlkXho7la+NUpzCMVzX6X0gQ0Yw6siLTv8xBaei6lcb7yB1e2/RSQHoeNM5TxXG3Zl+Bd4GCbFqJexnfnnXGap/f6U4XlVSAw7jq+Vrs9nvzQwujHTXIJIk+V2NYpQxMlQmYGbnZRk/6dkZ8r5yefeb7iO4Y+HPf7PkTt2qFt1v5V6mWPjSfwxMxkC+z/cs0IoXWO1BnUxr3lhoSXJ+GlJk4qSGOAgKofa9SI/SUp0/Hd6jRH8CUqVEGmVniizAIXkI+SX3Cr/DSFImLocWsMgj1i5y1ZNdSXzLMd1v8UkPh5cjJf7GChsZnIMabKXPhCQinOB054X+yBl6J3IsPXQuNu5rCKrSS2hsjhsnR5hcgiBYUC1GNSpD64FL7MFTnH4zACEmYwxDFW3Aa5xVJc9nYLz96qkagG06me6/Moy1D4ceNVuu6SXrmodvbjO4n6qrACCavxMZYWjsDnjlv0xHigaulR2qKwUEOaSH5Josq+qntRCSLhlVUVhT8VAV5CjusP9ar0byuocgwJL/CxW/e6Xlu9VQFzCN/OpgEUO3o3h5+xp5HnnkwdrHRcD4dl4twC6umZDDjd+6er72PN9poLfSWIvE2Z+kxcw9DXeTXHOClO9rLXOFRwA/BI="
  - secure: "PufKsyo8HZP75GGcWGgrGBoaX5OjmIhI7p+kaXYP2fLIZmhy6nSa2MRdGAGYIvNTM7Idxf5tQq+njipJpdIBqWnASXDcbjbW6mVXSXUvKn41IGhqpQfCGv76VunSU7hJA1H2+v5bU7HhdNnuKb49FsidSMhqEItbo6W/nN7Siax1S+YmLNdsrJZouzrk0QKj3zoQrRLbShbzdMsfD7T5+yAfrhi49gSQG3U414jzmG929IjJ1RcnCCu640smS3fXOgXsU/VBsN1UlHEcWMzUe7lt0wFNDAzW+cPpXaI1P9cP8DkdnLGUoESaD7ksVkFurjVTCTh1jPz9Hb4ibvsk9zKtwFLk5zQGKbdEeCdDY4i11en9M/90Srl6Qg+hwFNayx57A18fek6aKWYEjejb/C5N+wwMV0Nj8T4uL7laYg0peIpBEPHU2/HKpV1TZK6941PKujaDUEdUDqob/l4f9BFIqA0hU4ai+ImQmsBYXNWEnQUK1byL3jG4JJHSIExZHt0MK3UKWXFSy3+QfFuSRn9+KDGhJY3YsMbupgNei5dQjdB2iDui4M6WEl080J2h+HvFWQi0D8iCoVtuFQ0fbhHLdK1lXpcKtlecZ6caEqml0KsS9i8iEo8KH0DWIeUgzGSXm/j0GoAT7eFs1NmSXs32xHvcN1DXnupW9IuQ9eI="
  - secure: "cAKtVrnav9L6kGoUaNhlBtK9LsJtGv11KeQOl+IHmpO8XlElFLBhsqDeA8MmIP+URokfmqEDB5ciMcoMpm/w0/y4NHnQ1U8byu097CnkHuOFxABuhJxsLGq5pwn5uAui2uVgV4cCMla8Fm+b3x5TODxaku+GHQaVjlqAhZFY+0hlfEPJHhcTCzq/2wKTZVK2uHauOmoi3pGY6RhTGVlDP+amUyk5IzHDW1kLdxFi9LQUinukZ0h8H+arZ6Er6tE055rW8HkyD97hY/qjzk/F+EvGSzDtowFUOgnb2MTX2t5imxeW7e880MSSl1FwBMgJdcb4IhW8KfzoARYCsycOz92GyNbkLwA1m7s6RwW44dxrlszuHxjYgDQ8ayPuD7fue19x17K4MYw8mcotYFJQebzBlg9HfC63fENcY3zDCp1yMYnro/zBLJHmApArWkNFYmL9fi+OUWEt+aeNPZFUekhdgERTEJIpG85yfooYcpK9zOUEbkJ9OVNZkCLFCC9Rr3HttUqthYHgPqsfCcHtOA7NP/30HBQB0IpQJC/VZrzD+vDybkajXpQe/dRvJCWw+7O9ADLAIXbaces6II5eyj+BMfPY/n7JCuGiyOXvd8FBHKYfaosv9GC5yzJPBzJyjiA3kIxeY+4vGLtgkrEimS98YzsRcpW7IAcjkf2vzcU="
  - secure: "a0WEJMbtw/+nv7yvE7JBYyD+74TpJAsBU6CVbXzIBWsB3GWZKe5ZHmqFHaaftambHAz1OjPG0DCUghHRzdp0GVn3cznPbPI86ezQ/EbkctKlRQa+ZChULvTGgyinxWQoxrSVYgjfIZ09ZDhaWFqqK1ww+Z6ICCzvZA1c5YhmuxNoLTZoCmmHK81YVIkHnmE91bCnUW4Mr+BhE/sCn82uRf1d50AagvDn7AvAvtlnemD6GJvpdIH1W5sgaxrnyEnmWuAiX2Gur4lqwMtDpF846AgX/1Lf3tcfizh5pAq2ldOvXLDUQeOvY1YFrIlg5r69pYjibAsPNPnlaOVZNMlbh4ua4GfP8dVrRU4HpNczjwLFJi5mFMh8Uva/HwlO6HBHLYrekLH4iTofVOom2+uNqRbC2q7WzbKoNuTvwH3TXuDa6lIiYszwlTY62a3dIT1Je9YRZJbXa6sIfgSGa860WA8pa9DzFp5cqs8A/4SpbAgWxu/6QVhSXBIBuPp3sbTE+gsf+EVvKaSi7sVT16nj/H3kEwp6aicOzdhkXjm5/n5Wcq1DaTrx7g/xmTycVp364l4QDLIKpEnVRwOChYyaGIjaW8BXwYqMPU9dYm87EoP5OvTJIzbt+2v3IZgVv27oFU0W6PRnUiSuWNtmSLWqQM+wMHz0FfkRPsL2iJX0Chg="
  - secure: "ncsLUkoVDyeDo1dRu/2jP7/C0biZvDJzar6LocczMIpYQCiW39QYQisht+4ny/Cu5/I7fcj6ULWyi2B5KrREWzpq1IxYg1GGk1aOKVePIRz9M29otDZpQYKUaab8xnwPyUgQBYaJ5b+tQ0p7TeYcEQ+X75HF7N/dtHzaFEPRDKKCCEUkxAsgz4PXVCjJJ3TPMBICUZT+g/Z3oNA/nAwj1myyeBCcOdBPYl6lJIZuQB8WKj4OFCoYM8WN5UsxJKFTBZFSqbKeCnRWgr81IpCdQvuuXH2CMkcjprwnr+QNI1HgXX6pVgeTpTMIP2/WOTOgF5qx1pQUa2aDRZ3AdRQSUvmyS0DqI00TyulJWOAcDXDN/vPp4FhybV6/ROXUvre3mR7oOVQWyzPvJr5e9lXUaj14mO/xwMElbyaNJOYGtA7sxlVvSY+4eJXdAm0WktKNQ3NoCGobxNUKReYPP7p0rtE9dFD9kztZlovXmpEvmlPyZYxUkZxwtoiKwU19dzupL8H2OIC0sVTrqpp37tzK01SEQ/V4Ef0zEsp1DbxRGhugYoQhhfbu2MBcMTfht+0HSvfkUZf6KN+x29baO956Dkmc1GOQZ4/zhHYPirLK/KsRxU2WuN8ksFRA5K128FxP4WolWlyl8XBshJQhh5wDVl8f5Dq15xaqR7oLyl3zM+g="
  - secure: "UB21RbmicswGFAy73IlmFSRa6Y9rzuXg68nTvuwQPjHRhjWPXhfoLnMOc5t5gOEqQ/dXx104YNi3axl31VSOyPWThJhIyJl21NxClKE2kDOsntRo3aKe8YLGHgjG31RWDZA2RuZej/4JYfcswaR+ukjuR2nis7WUtppC6Sm6e5nb5QgPz0JjINpm4ItPLlBSOLjatt8C0ySG3tiPa7jvA3Baw5zVAn3wg2+90aPoTJht/pmtMQrFoizoN1xHg8KTIXeB3ScOG3NEW2F0spYOgeTHDVF1gATNvCcUfuZyFOBGbFDkhzIMIe1ih8NPqv3KuksmLtr6wvQHfzY3nnCOhP3kOpAgKazdi3fLT5MxGZPauByTIO1xJ4b/nVkEZ1TRjgsI0wwRpZwvO2weKD7kkYAKErao/8E6yfHiJ09NLe+1vcxC7l1dfMACwZjoKs3ZnxAoWiSyl2Le8R36hEuDoqRQXVtLpax/xcYqaueJGNDnOmmx3E6X5dVwf2tLIQ1uFMThq1hBwibFn6mHC6QBRwhvIItxQ5l4Sx8+tJCbKnwF6M9tf6xNvSgO83wLwbgVq/E5Ty9geYUNoAeZJSPrCz0DXNHaOK2e66jj0XBYzKhZRD/yKSs0d2Eh5RUTFMRzxOMEQZRA8z6G9PkTlWh8VooWb3+RwovC6NFGJKjDeo0="
  - TF_VERSION="1.0.9"

script:
- docker build --tag todo-app:test --target test .
- docker run todo-app:test todo_app/Tests/test_items.py
- docker run --env-file .env.test todo-app:test todo_app/Tests/test_app.py
- docker run --env MONGO_URL todo-app:test todo_app/Selenium_Tests/test_Selenium.py

install:
- wget https://releases.hashicorp.com/terraform/"$TF_VERSION"/terraform_"$TF_VERSION"_linux_amd64.zip
- unzip terraform_"$TF_VERSION"_linux_amd64.zip
- sudo mv terraform /usr/local/bin/
- rm terraform_"$TF_VERSION"_linux_amd64.zip
- terraform init

before_deploy:
- echo $DOCKER_PASSWORD | docker login --username $DOCKER_USER --password-stdin
- docker build --tag $DOCKER_USER/todo-app:latest --target production .
- docker push $DOCKER_USER/todo-app:latest
- terraform apply -auto-approve
- export WEBHOOK_URL="$(terraform output -raw cd_webhook"
deploy:
  provider: script
  script: bash ./webhook.sh
  on:
    branch: module_12

