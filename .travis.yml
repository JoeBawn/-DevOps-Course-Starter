services:
- docker

env:
  global:
  - secure: "b7f77aPg0gOJ5nHcKBiR6Pu7+V2Mq4TZ+f6bcmCmyNh7jpNwZd0PN2XRKaGuautFfGMd7RmkKsdfyWDeqm3J+YR6LzEqwaAULfzvrlQNId8AVFfrke/uoNwNOUczX5L9h5zpLK63AzUXIO8KwVO4d8xBV8wtcW+AqjC5q79Wq2ZfETELN7l+0ZtaAwjgdDtMufhcRvZ8TIw1VTM6D6fclumf7qaoDZF3BSnS8Ar+m9yfuMDoDckt+dT2bFEBN+SK3/IOJdHxlzbMsEQSDrz6c1HA+rOkiEYDnO7wfJguyTJp3LURBDlt2ScMsL2LGXiV0Y0rK26lvizGjlvgSfQmK7dG1Xtv8fPDS++K+E2Mpa8jiCb4ZxAxxJs7j4KK+hBpsjTBglE6k7Zb0/IeLYaf05SKwVz9+e5zrlaCBQ5vul9XQikLy1fHw4jXIMqjzaHlWt5SqFX2p+yK31xs76aCNNy/RT/QKjEh6iEwsN3QEzAgHqecjehArbSGod5Q1t0rNspsssUj8li3iFRu3cmoBSlSpsqtndu7i0FP5lIRHbE4p/Xq1Gw4XNM2FCD+1bLiyJQfkSWNeghIA189cECvLDyjyiaNNg3bZHMKa1ocjqRzOF1Hj9JMksAxSyxD6zYwXvEvl8ku6gog1MvEfTgiP+kQAAnnOOUjvq5IjlU2s64="
  - secure: "Shfykzt3i9J5ShuzzPS9A9YapSYE9ggyUckybq11KS7mfv4RegaWHQTIkohUbdP9covts9+m+vaBMUqHKpTqCGtZZv5TEoDCypohXujc9ml1Kk3qc3N/6FYrpt8qirplWRMuicCpvmIRzrQ22kpNupkE+7SkjB5T9JzKeyFZHDX5+fTFF2O41VhUvdZDBSPl+UtlCwruSzlBxHc7ZQZswxQgEy90SX5mJspH+QANRPE+hMpMVPUgrExnC4N7gVFCqnIOcSgzk4u/RbMm1Fye6a6+h1mU6Rmm9e/86oZ0LU1vTdj6TFYOapT0WrPw8W7X1rTC+29YnHg3ikvoHqQo0+uWhRP5Wb6BHtq12xfYQVlGgy+kRV2pfB7AEPlOp9jCQeAWx0iu0Of1QCuWyRQKM89JUErc4Ee2aOWJPr45EZaUPWzObfRET8QJIRxiX21520KiIc2MOd6dOzDba5SHJk3ZcvTHwC00ZfbG2/dmEkw8fgQwQHfG+YszfkO8LuCaitRFU19+q/qf4IfMJNMZUVtok4uuW63jkurSXDR4ub8mbyHH42Rj8+x1/NuuCq54cTw0lF8ya3ZNIp2StMqjnK1m5XUXoqVbB1PCry9MlggNKnqEW5wFTNuS6pyrW8GanfeSITI+36StpGGwlHNhSFg0BzR78Hc059kxy8YYKqs="
  - secure: "d4NtPyHgynqStDDrE/vBG3BWAM4fJn4x5f7fnfwLmanooYrtC2zd7EAIfTBTnF0e3rgJDJt+3MeLjIlOlBxJddDboUtcQkkEwFayhwnHEvxCnRyPS9oLMmRsmqiSULCA9U5sFtilVRHGDejCWKpoWUagVvzLjga1MlL/dweUR24046VjD0m6javl0i0a0GED9RxARGJo0vlj31jOXJu9RDi2w+0ppkCOxcYeH9+Dzt02yhrpX0s9DTskZzDw4JdUym7W6fA0e06yK9MEOshMgfQOokE1qt3X6fJFKSvds1dnXOrL6+2JyvNyiuc/JRDujP6+Y+whJhhg2hKF91AU/udenT8VdOPQEY94yK3zVtebjjwv08iIZdJ7pGOp76qb3EGZV7rN2kjzum7Ay7sFhmtoTcTPrO/1oIjf4eCxIOPWMr21njPmsUrufBxAjEMuB8M/HR6y9ZPhm+wpHbUU9wD0YhNLS1j9i0sCEaUF6fJMDcPDIHBmvsfGGIN7VTRaMwvgfeFftDakH2Z8Ore8ZZ6j/lxytcbXu4n/pl/JJUXbF8+bw6GZrAguLPrh0qbqQTPJXSzHKBh53+1nTh5s63PDXZ4XXgT9v/ghMyW4AyxNosRvmqjrPAihQiAjSPqKebP1gBJgPJH6WyNLJpnKBirewgulus1t8Q0EVfWSUS8="
  - secure: "EctP//85ifHzyDAaNDF4Zic/0rZxwx+RJn5IcUbsW3hLv6KfK94S2ybwlg5UnXgB5w5fKNQrNWMMNx0XPQ+bcsEQX43yBpJwpKeXXqwN8jYON3nsroVbkE9Bq//tU/Tbee5ihQRFIu0EOOtfinpkAtKvw3VUYqmyUPN9HOxVsj9ee/5pbgnCAPuu3YcThhMC5fvbD0xeaPQ/oqNW17WkDmRONtLQWoF5o/h1s+atkCR+rbFtggF8N4MJkyCbiryL7U0p3UQW5gRls0SbWfsPhUSAH4Sy7phyYApH4PlU2A+SoWUJ2MFgr3tQ0T3Jlb7Ana3JRHWF9pEnBnBI0BllL/SRk7P1B+qkzu7PWxuzxlAhxMeYjZnikR1N85jyTmQQi+XaUs2BPGPjoZ8IpJoGcsDsXiygoMT9xErMzGZDo4/bdaNAWI+fCA9gnnix39I/c67VP/9TCYZPlzxgr/sdbC6kURZ0oP1spjb37fd0+EfO0K5PZZW8RzK3wZ9TUg4gPGM1pFmIAypetoMj3AzwaDW73CQ9NMAuzvw491D99dFWhJ/FbG4hEhxdFFizSYbzuewH/sD0SHS4mDBs6wV8RB+OXKvnDkeGBb8zz5ij1dYrMPe1SXIAdTEEMzf6CjHhaOKrqWFs0t4ppQdntgtXxWWlDfNgAE5IPxlg+QKNW1E="
  - secure: "Hx62qRgxYb+zz3tdjuxT/MISZt388OAFV9aZdOGHiEMvlwmHQ7aIn98f2Bc6DZcTNYBItvt7rgk4ueskXfChxoIM+KCV/o915/qw5BldurqHUI1KLJuoKVwybly1G1F/De4zlmueNyitOISvmFg4X24QUk+LirI7xv+96NCOvwC6b69tYY2xqI3Dugdtne0oJlipaX+2wwcdt4p/d8luPUukjHmyvKzfvRGzmTFF0XihRDPjDFggW23j5y/XVU7JWogNK2wKQv8VUVRfJEJqdPUCfz3P/05fFzogKAF9Nc21FsDG2OIarbFtfgKzU2zLsY7HU9lrmwFN5/5tr2oQ+rwdMAJSuBTBAPLRkqMI3xTlwe8KNrnam/MAQTR9n2adGotMJaEfECzDQNhkcZaXKtroFGXzRG4ciQDdcmgSbmzplWgomU4z3ZaeotEiRvjXkZyPgDZwed5rNQQRSwCl86JCsoRz04THXKUmBwe+OfJZoJ9b3UjclMjGrFy/eZpOxb99jPHZ6pVs8PvWBQDvpXBnGTrp7taTle7Z5gxtBKr/6IZG8hw0ITK94rdDkAz3I/FDkU8Yg+aEiC95vn7HIYhgR7C90pD+2e33bKR+KA8rVl3uSF2qpj22DmemZZCQUDrcIxQJ2/yCC5k8DTUm5nLh0SvG9oCqdpeULVeHeHY="
  - secure: "r5CW4neJh0U2gVe7UW+LvAhwE028yLR0Utl5PO/KDpKSiagtEWiSKOuxDqwTBlTOGZtWArfPH4bnfow59t2fsCighikwxcR5kRhm4cQiS7LpE55i5kNbc2wWd0yoAFUfbGuBmwxSGXAgUUPg2bR3PwopruhrINfzbRu9nfrPWexc3lsWb5mkqaCCYdCyQAI4R2SmJE1TNWkh2js7QL0mGBdMbdPcyxriTBcxJNy0aHLdpAdM65Z3ZECv6UT2bkRd5uJnxmLjItnSJOOUNhCAKFs3USTHHyN0CDJRf5An5DAJB9LF/lHC8xiKf/b8R/hMBhIMkkhGgxrGUrAK3Ekf8RHawZTf+smheg6VfIgdjXXGgJQTQzwnNcOU21vbICoEcpLuT3woK+x1/8PFsI4jtpAZYOwUB0d8ERw7FjXCMNXMu79kHm2c8PWhmO1Y15MvkHm/nFWzwmZNOg9KcG2hIzNgUqV+ebzoz+38FGm7Z4YB4CHDBgBmagSYZSnlCbHS0DWr4jhQgFl/VHkZfuFpAAnU+cIA1zgpykLUhg1WE45Y6CFWrFkiMrTqGU5n2OVv/Fa87OReB7JYDzRVg4h5f3l3tfFuZRh+8qm18/yDukr2MuREix0dk2db/I6HqqVVMsyn9lPbNObFATg79kHaIIeOSUQZbI7TiAorGnrlViY="
  - secure: "d7N8rSODEzUgbgnukasKklJy+2UUMJus+Cg292t8c1ECIxsp01RNca1Tgi7UxtsZxK4a0D41po1r7B2zz7mGfxD92hI2pG0jubaUD4kMWKIoufFaUt64yXNMEzpmo4JcUOBaps2Nrf8EgeREXs7lgHOuhxWVczzpwNULLPac+xqHxxIzATSs5vzUQTOfHJGCCKvsZ9zHa5VU/7houPIB0ftrEE3zQWwDSF8txlUKfyWrbCb81JK5L7Hi1dbu7ii3ebc9RPxsW/rb1N0VCv/1ZUiMyIcEuHv153E1QfZORKSe3PPfcWfVQYTEG7hNWPorQtDGIihMHfDX/DoV06WLMQj4ka73BfegFoHyt3ekjg3s+c0WFRv10O3BuF28w5d8rNy1POgjkPPeALYfxZJxvGUepsCL3v+aKORma4f+3nWXKIbMr14nrJSJTDIHTHP29KM3JQBZ5RozBCIb/WtVjoAteKqh+tkWogT1PyAKuSWfaUwc4kcF28IeyZ5B90I4hBwavVsdYKtmrl2BdW7vyqqC44fBzXRvGv+jtGKaLjdBITgkQ/4GOT1eHZ92tbMIT75IF750iyQni51KmbPefgOUSr79B1IvxGGwv8/BrSUsCwdvCfeFLJD0KZmtAaHkOJgtzU81Alm1TiqfOLh9A+EXEIqEjCY8ZE7IwqSXzo8="
  - secure: "bNrgVOlKf3ham8uf/Ml4toCVT7SVF5+x/NVtDgG8Qza+91VlkXho7la+NUpzCMVzX6X0gQ0Yw6siLTv8xBaei6lcb7yB1e2/RSQHoeNM5TxXG3Zl+Bd4GCbFqJexnfnnXGap/f6U4XlVSAw7jq+Vrs9nvzQwujHTXIJIk+V2NYpQxMlQmYGbnZRk/6dkZ8r5yefeb7iO4Y+HPf7PkTt2qFt1v5V6mWPjSfwxMxkC+z/cs0IoXWO1BnUxr3lhoSXJ+GlJk4qSGOAgKofa9SI/SUp0/Hd6jRH8CUqVEGmVniizAIXkI+SX3Cr/DSFImLocWsMgj1i5y1ZNdSXzLMd1v8UkPh5cjJf7GChsZnIMabKXPhCQinOB054X+yBl6J3IsPXQuNu5rCKrSS2hsjhsnR5hcgiBYUC1GNSpD64FL7MFTnH4zACEmYwxDFW3Aa5xVJc9nYLz96qkagG06me6/Moy1D4ceNVuu6SXrmodvbjO4n6qrACCavxMZYWjsDnjlv0xHigaulR2qKwUEOaSH5Josq+qntRCSLhlVUVhT8VAV5CjusP9ar0byuocgwJL/CxW/e6Xlu9VQFzCN/OpgEUO3o3h5+xp5HnnkwdrHRcD4dl4twC6umZDDjd+6er72PN9poLfSWIvE2Z+kxcw9DXeTXHOClO9rLXOFRwA/BI="
  - secure: "OZZYcxPW6KdvvZKA7ASVZyFBoaHThJbmVXd2lrNzcFRu5LrmASJm1V/nCrMi1CKAeWaNcoQjwYs7j87T4WdcUurJDLCxfs+8Aq5QsFtXG07OZz/zAnDwqKijGZsu3qZxN8KMUqUESBZsKep8LWK+2C2ffU6vhQBBMxh+vxhf9MCfck6COim5/tTW9ywfCjmQJ8+YVfMrYIC/6tMIP/ezmeTMHeS34IV/HULYf76d0bhC1/Y4lpitSNDfjZe4kw99Yn96wPDH9qiHiKgq5dQIduGHtEbW6FJSQ+RBSMdYsTSPfcYPZjJmymNXsym259Ml1UKxfRZCCbVZcp5dKcuut6++E7X49DkgPE1kkpeeIrEoMqFNxMs5WOB7bx+8xi4A+mVreE5VBqIvJpvpC/jMNJlpSkGQFLpStrUin8tW+a2ghWh3x4GkiLAhEpEEZnzY655XyFDhBIgP/QjhTrp+RDoJrE72VZYiOOh1QoBM2uaYtma1X0yeoHWPbTWWv2J23uCsTEKP8ijfHkuHiqNFfjJWX3C5bFRYJS5ZhTvFJXSiOeAOtPz9ietLyPbIYxpjgwCSX7/O989TUZ1cNpBEOJBGCuVz4NX/Kj39qHMHYVqr2BeOvd5g5/b9Ets2NvloM12YRqigEliHlSlr0U37v6LhHfFvGJ70U7KqN3bmDmg="
  

script:
- docker build --tag todo-app:test --target test .
- docker run todo-app:test todo_app/Tests/test_items.py
- docker run --env-file .env.test todo-app:test todo_app/Tests/test_app.py
- docker run --env MONGO_URL todo-app:test todo_app/Selenium_Tests/test_Selenium.py

before_deploy:
- echo $DOCKER_PASSWORD | docker login --username $DOCKER_USER --password-stdin
- heroku container:login
- docker build --tag $DOCKER_USER/todo-app:latest --target production .
- docker push $DOCKER_USER/todo-app:latest
- docker tag $DOCKER_USER/todo-app:latest registry.heroku.com/todoapp-jb/web  
- docker push registry.heroku.com/todoapp-jb/web
  
deploy:
  provider: script
  script: heroku container:release web --app todoapp-jb && chmod a+rwx ./webhook.sh && bash ./webhook.sh
  on:
    branch: module_11

